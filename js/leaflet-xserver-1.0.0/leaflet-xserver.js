/*! leaflet-xserver - v1.0.2 - 2017-02-23 */


!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.leafletXserver=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){if(a)return e(a)}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}"undefined"!=typeof b&&(b.exports=d),d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],2:[function(b,c,d){(function(e){!function(b){if("object"==typeof d&&"undefined"!=typeof c)c.exports=b();else if("function"==typeof a&&a.amd)a([],b);else{var f;f="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:this,(f.L||(f.L={})).NonTiledLayer=b()}}(function(){return function a(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof b&&b;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b?b:a)},l,l.exports,a,c,d,e)}return d[h].exports}for(var g="function"==typeof b&&b,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){(function(a){"use strict";var c="undefined"!=typeof window?window.L:"undefined"!=typeof a?a.L:null;c.NonTiledLayer.WMS=c.NonTiledLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},options:{crs:null,uppercase:!1},initialize:function(a,b){this._wmsUrl=a;var d=c.extend({},this.defaultWmsParams);for(var e in b)c.NonTiledLayer.prototype.options.hasOwnProperty(e)||c.Layer&&c.Layer.prototype.options.hasOwnProperty(e)||(d[e]=b[e]);this.wmsParams=d,c.setOptions(this,b)},onAdd:function(a){this._crs=this.options.crs||a.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[b]=this._crs.code,c.NonTiledLayer.prototype.onAdd.call(this,a)},getImageUrl:function(a,b,d){var e=this.wmsParams;e.width=b,e.height=d;var f=this._crs.project(a.getNorthWest()),g=this._crs.project(a.getSouthEast()),h=this._wmsUrl,i=i=(this._wmsVersion>=1.3&&this._crs===c.CRS.EPSG4326?[g.y,f.x,f.y,g.x]:[f.x,g.y,g.x,f.y]).join(",");return h+c.Util.getParamString(this.wmsParams,h,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+i},setParams:function(a,b){return c.extend(this.wmsParams,a),b||this.redraw(),this}}),c.nonTiledLayer.wms=function(a,b){return new c.NonTiledLayer.WMS(a,b)},b.exports=c.NonTiledLayer.WMS}).call(this,"undefined"!=typeof e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){(function(a){"use strict";var c="undefined"!=typeof window?window.L:"undefined"!=typeof a?a.L:null;c.NonTiledLayer=(c.Layer||c.Class).extend({includes:c.Mixin.Events,options:{attribution:"",opacity:1,zIndex:void 0,minZoom:0,maxZoom:18,pointerEvents:null,errorImageUrl:"data:image/gif;base64,R0lGODlhAQABAHAAACH5BAUAAAAALAAAAAABAAEAAAICRAEAOw==",bounds:c.latLngBounds([-85.05,-180],[85.05,180]),useCanvas:void 0},key:"",initialize:function(a){c.setOptions(this,a)},onAdd:function(a){this._map=a,"undefined"==typeof this._zoomAnimated&&(this._zoomAnimated=c.DomUtil.TRANSITION&&c.Browser.any3d&&!c.Browser.mobileOpera&&this._map.options.zoomAnimation),c.version<"1.0"&&this._map.on(this.getEvents(),this),this._div||(this._div=c.DomUtil.create("div","leaflet-image-layer"),this.options.pointerEvents&&(this._div.style["pointer-events"]=this.options.pointerEvents),"undefined"!=typeof this.options.zIndex&&(this._div.style.zIndex=this.options.zIndex),"undefined"!=typeof this.options.opacity&&(this._div.style.opacity=this.options.opacity)),this.getPane().appendChild(this._div);var b=!!window.HTMLCanvasElement;"undefined"==typeof this.options.useCanvas?this._useCanvas=b:this._useCanvas=this.options.useCanvas,this._useCanvas?(this._bufferCanvas=this._initCanvas(),this._currentCanvas=this._initCanvas()):(this._bufferImage=this._initImage(),this._currentImage=this._initImage()),this._update()},getPane:function(){return c.Layer?c.Layer.prototype.getPane.call(this):(this.options.pane?this._pane=this.options.pane:this._pane=this._map.getPanes().overlayPane,this._pane)},onRemove:function(a){this.getPane().removeChild(this._div),this._useCanvas?(this._div.removeChild(this._bufferCanvas),this._div.removeChild(this._currentCanvas)):(this._div.removeChild(this._bufferImage),this._div.removeChild(this._currentImage))},addTo:function(a){return a.addLayer(this),this},_setZoom:function(){this._useCanvas?(this._currentCanvas._bounds&&this._resetImageScale(this._currentCanvas),this._bufferCanvas._bounds&&this._resetImageScale(this._bufferCanvas)):(this._currentImage._bounds&&this._resetImageScale(this._currentImage),this._bufferImage._bounds&&this._resetImageScale(this._bufferImage))},getEvents:function(){var a={moveend:this._update};return this._zoomAnimated&&(a.zoomanim=this._animateZoom),c.version>="1.0"&&(a.zoom=this._setZoom),a},getElement:function(){return this._div},setOpacity:function(a){return this.options.opacity=a,this._div&&c.DomUtil.setOpacity(this._div,this.options.opacity),this},setZIndex:function(a){return a&&(this.options.zIndex=a,this._div&&(this._div.style.zIndex=a)),this},bringToFront:function(){return this._div&&this.getPane().appendChild(this._div),this},bringToBack:function(){return this._div&&this.getPane().insertBefore(this._div,this.getPane().firstChild),this},getAttribution:function(){return this.options.attribution},_initCanvas:function(){var a=c.DomUtil.create("canvas","leaflet-image-layer");return this._div.appendChild(a),a._image=new Image,this._ctx=a.getContext("2d"),this._map.options.zoomAnimation&&c.Browser.any3d?c.DomUtil.addClass(a,"leaflet-zoom-animated"):c.DomUtil.addClass(a,"leaflet-zoom-hide"),c.extend(a._image,{onload:c.bind(this._onImageLoad,this),onerror:c.bind(this._onImageError,this)}),a},_initImage:function(){var a=c.DomUtil.create("img","leaflet-image-layer");return this._div.appendChild(a),this._map.options.zoomAnimation&&c.Browser.any3d?c.DomUtil.addClass(a,"leaflet-zoom-animated"):c.DomUtil.addClass(a,"leaflet-zoom-hide"),c.extend(a,{galleryimg:"no",onselectstart:c.Util.falseFn,onmousemove:c.Util.falseFn,onload:c.bind(this._onImageLoad,this),onerror:c.bind(this._onImageError,this)}),a},redraw:function(){return this._map&&this._update(),this},_animateZoom:function(a){this._useCanvas?(this._currentCanvas._bounds&&this._animateImage(this._currentCanvas,a),this._bufferCanvas._bounds&&this._animateImage(this._bufferCanvas,a)):(this._currentImage._bounds&&this._animateImage(this._currentImage,a),this._bufferImage._bounds&&this._animateImage(this._bufferImage,a))},_animateImage:function(a,b){if("undefined"==typeof c.DomUtil.setTransform){var d=this._map,e=a._scale*d.getZoomScale(b.zoom),f=a._bounds.getNorthWest(),g=a._bounds.getSouthEast(),h=d._latLngToNewLayerPoint(f,b.zoom,b.center),i=d._latLngToNewLayerPoint(g,b.zoom,b.center)._subtract(h),j=h._add(i._multiplyBy(.5*(1-1/e)));a.style[c.DomUtil.TRANSFORM]=c.DomUtil.getTranslateString(j)+" scale("+e+") "}else{var d=this._map,e=a._scale*a._sscale*d.getZoomScale(b.zoom),f=a._bounds.getNorthWest(),g=a._bounds.getSouthEast(),h=d._latLngToNewLayerPoint(f,b.zoom,b.center);c.DomUtil.setTransform(a,h,e)}a._lastScale=e},_resetImageScale:function(a){var b=new c.Bounds(this._map.latLngToLayerPoint(a._bounds.getNorthWest()),this._map.latLngToLayerPoint(a._bounds.getSouthEast())),d=b.getSize(),e=this._map.getSize(),f=d.x/e.x;a._sscale=f,c.DomUtil.setTransform(a,b.min,f)},_resetImage:function(a){var b=new c.Bounds(this._map.latLngToLayerPoint(a._bounds.getNorthWest()),this._map.latLngToLayerPoint(a._bounds.getSouthEast())),d=b.getSize();c.DomUtil.setPosition(a,b.min),a._sscale=1,this._useCanvas?(a.width=d.x,a.height=d.y):(a.style.width=d.x+"px",a.style.height=d.y+"px")},_getClippedBounds:function(){var a=this._map.getBounds(),b=a.getSouth(),d=a.getNorth(),e=a.getWest(),f=a.getEast(),g=this.options.bounds.getSouth(),h=this.options.bounds.getNorth(),i=this.options.bounds.getWest(),j=this.options.bounds.getEast();b<g&&(b=g),d>h&&(d=h),e<i&&(e=i),f>j&&(f=j);var k=new c.LatLng(d,e),l=new c.LatLng(b,f);return new c.LatLngBounds(k,l)},_update:function(){if(this._map.getZoom()<this.options.minZoom||this._map.getZoom()>this.options.maxZoom)return void(this._div.style.visibility="hidden");this._div.style.visibility="visible";var a=this._getClippedBounds(),b=this._map.latLngToContainerPoint(a.getNorthWest()),d=this._map.latLngToContainerPoint(a.getSouthEast()),e=d.x-b.x,f=d.y-b.y;if(!(e<32||f<32)){var g;this._useCanvas?(this._bufferCanvas._scale=this._bufferCanvas._lastScale,this._currentCanvas._scale=this._currentCanvas._lastScale=1,this._bufferCanvas._sscale=1,this._currentCanvas._bounds=a,this._resetImage(this._currentCanvas),g=this._currentCanvas._image):(this._bufferImage._scale=this._bufferImage._lastScale,this._currentImage._scale=this._currentImage._lastScale=1,this._bufferImage._sscale=1,this._currentImage._bounds=a,this._resetImage(this._currentImage),g=this._currentImage),this.key=""+a.getNorthWest()+", "+a.getSouthEast()+", "+e+", "+f,this.getImageUrl?(g.src=this.getImageUrl(a,e,f),g.key=this.key):this.getImageUrlAsync(a,e,f,this.key,function(a,b,c){g.key=a,g.src=b,g.tag=c}),this._useCanvas?c.DomUtil.setOpacity(this._currentCanvas,0):c.DomUtil.setOpacity(this._currentImage,0)}},_onImageError:function(a){this.fire("error",a),c.DomUtil.addClass(a.target,"invalid"),a.target.src!==this.options.errorImageUrl&&(a.target.src=this.options.errorImageUrl,this._onImageDone(!1,a))},_onImageLoad:function(a){if(a.target.src!==this.options.errorImageUrl){if(c.DomUtil.removeClass(a.target,"invalid"),!a.target.key||a.target.key!==this.key)return;this._onImageDone(!0,a)}},_onImageDone:function(a,b){if(this._useCanvas)this._render(b);else{c.DomUtil.setOpacity(this._currentImage,1),c.DomUtil.setOpacity(this._bufferImage,0),this._addInteraction&&this._currentImage.tag&&this._addInteraction(this._currentImage.tag);var d=this._bufferImage;this._bufferImage=this._currentImage,this._currentImage=d,this.fire("load",b)}},_render:function(a){var b=this._currentCanvas.getContext("2d");b.drawImage(this._currentCanvas._image,0,0),c.DomUtil.setOpacity(this._currentCanvas,1),c.DomUtil.setOpacity(this._bufferCanvas,0),this._addInteraction&&this._currentCanvas._image.tag&&this._addInteraction(this._currentCanvas._image.tag);var d=this._bufferCanvas;this._bufferCanvas=this._currentCanvas,this._currentCanvas=d,this.fire("load",a)}}),c.nonTiledLayer=function(){return new c.NonTiledLayer},b.exports=c.NonTiledLayer}).call(this,"undefined"!=typeof e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[2,1])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b,c){function d(){}function e(a){if(!p(a))return a;var b=[];for(var c in a)f(b,c,a[c]);return b.join("&")}function f(a,b,c){if(null!=c)if(Array.isArray(c))c.forEach(function(c){f(a,b,c)});else if(p(c))for(var d in c)f(a,b+"["+d+"]",c[d]);else a.push(encodeURIComponent(b)+"="+encodeURIComponent(c));else null===c&&a.push(encodeURIComponent(b))}function g(a){for(var b,c,d={},e=a.split("&"),f=0,g=e.length;f<g;++f)b=e[f],c=b.indexOf("="),c==-1?d[decodeURIComponent(b)]="":d[decodeURIComponent(b.slice(0,c))]=decodeURIComponent(b.slice(c+1));return d}function h(a){var b,c,d,e,f=a.split(/\r?\n/),g={};f.pop();for(var h=0,i=f.length;h<i;++h)c=f[h],b=c.indexOf(":"),d=c.slice(0,b).toLowerCase(),e=u(c.slice(b+1)),g[d]=e;return g}function i(a){return/[\/+]json\b/.test(a)}function j(a){this.req=a,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var b=this.xhr.status;1223===b&&(b=204),this._setStatusProperties(b),this.header=this.headers=h(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&a._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function k(a,b){var c=this;this._query=this._query||[],this.method=a,this.url=b,this.header={},this._header={},this.on("end",function(){var a=null,b=null;try{b=new j(c)}catch(b){return a=new Error("Parser is unable to parse the response"),a.parse=!0,a.original=b,c.xhr?(a.rawResponse="undefined"==typeof c.xhr.responseType?c.xhr.responseText:c.xhr.response,a.status=c.xhr.status?c.xhr.status:null,a.statusCode=a.status):(a.rawResponse=null,a.status=null),c.callback(a)}c.emit("response",b);var d;try{c._isResponseOK(b)||(d=new Error(b.statusText||"Unsuccessful HTTP response"),d.original=a,d.response=b,d.status=b.status)}catch(a){d=a}d?c.callback(d,b):c.callback(null,b)})}function l(a,b,c){var d=t("DELETE",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d}var m;"undefined"!=typeof window?m=window:"undefined"!=typeof self?m=self:(console.warn("Using browser-only version of superagent in non-browser environment"),m=this);var n=a("component-emitter"),o=a("./request-base"),p=a("./is-object"),q=a("./is-function"),r=a("./response-base"),s=a("./should-retry"),t=c=b.exports=function(a,b){return"function"==typeof b?new c.Request("GET",a).end(b):1==arguments.length?new c.Request("GET",a):new c.Request(a,b)};c.Request=k,t.getXHR=function(){if(!(!m.XMLHttpRequest||m.location&&"file:"==m.location.protocol&&m.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}throw Error("Browser-only verison of superagent could not find XHR")};var u="".trim?function(a){return a.trim()}:function(a){return a.replace(/(^\s*|\s*$)/g,"")};t.serializeObject=e,t.parseString=g,t.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},t.serialize={"application/x-www-form-urlencoded":e,"application/json":JSON.stringify},t.parse={"application/x-www-form-urlencoded":g,"application/json":JSON.parse},r(j.prototype),j.prototype._parseBody=function(a){var b=t.parse[this.type];return this.req._parser?this.req._parser(this,a):(!b&&i(this.type)&&(b=t.parse["application/json"]),b&&a&&(a.length||a instanceof Object)?b(a):null)},j.prototype.toError=function(){var a=this.req,b=a.method,c=a.url,d="cannot "+b+" "+c+" ("+this.status+")",e=new Error(d);return e.status=this.status,e.method=b,e.url=c,e},t.Response=j,n(k.prototype),o(k.prototype),k.prototype.type=function(a){return this.set("Content-Type",t.types[a]||a),this},k.prototype.accept=function(a){return this.set("Accept",t.types[a]||a),this},k.prototype.auth=function(a,b,c){switch("object"==typeof b&&null!==b&&(c=b),c||(c={type:"function"==typeof btoa?"basic":"auto"}),c.type){case"basic":this.set("Authorization","Basic "+btoa(a+":"+b));break;case"auto":this.username=a,this.password=b;break;case"bearer":this.set("Authorization","Bearer "+a)}return this},k.prototype.query=function(a){return"string"!=typeof a&&(a=e(a)),a&&this._query.push(a),this},k.prototype.attach=function(a,b,c){if(b){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(a,b,c||b.name)}return this},k.prototype._getFormData=function(){return this._formData||(this._formData=new m.FormData),this._formData},k.prototype.callback=function(a,b){if(this._maxRetries&&this._retries++<this._maxRetries&&s(a,b))return this._retry();var c=this._callback;this.clearTimeout(),a&&(this._maxRetries&&(a.retries=this._retries-1),this.emit("error",a)),c(a,b)},k.prototype.crossDomainError=function(){var a=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");a.crossDomain=!0,a.status=this.status,a.method=this.method,a.url=this.url,this.callback(a)},k.prototype.buffer=k.prototype.ca=k.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},k.prototype.pipe=k.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},k.prototype._appendQueryString=function(){var a=this._query.join("&");if(a&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+a),this._sort){var b=this.url.indexOf("?");if(b>=0){var c=this.url.substring(b+1).split("&");q(this._sort)?c.sort(this._sort):c.sort(),this.url=this.url.substring(0,b)+"?"+c.join("&")}}},k.prototype._isHost=function(a){return a&&"object"==typeof a&&!Array.isArray(a)&&"[object Object]"!==Object.prototype.toString.call(a)},k.prototype.end=function(a){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=a||d,this._appendQueryString(),this._end()},k.prototype._end=function(){var a=this,b=this.xhr=t.getXHR(),c=this._formData||this._data;this._setTimeouts(),b.onreadystatechange=function(){var c=b.readyState;if(c>=2&&a._responseTimeoutTimer&&clearTimeout(a._responseTimeoutTimer),4==c){var d;try{d=b.status}catch(a){d=0}if(!d){if(a.timedout||a._aborted)return;return a.crossDomainError()}a.emit("end")}};var d=function(b,c){c.total>0&&(c.percent=c.loaded/c.total*100),c.direction=b,a.emit("progress",c)};if(this.hasListeners("progress"))try{b.onprogress=d.bind(null,"download"),b.upload&&(b.upload.onprogress=d.bind(null,"upload"))}catch(a){}try{this.username&&this.password?b.open(this.method,this.url,!0,this.username,this.password):b.open(this.method,this.url,!0)}catch(a){return this.callback(a)}if(this._withCredentials&&(b.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof c&&!this._isHost(c)){var e=this._header["content-type"],f=this._serializer||t.serialize[e?e.split(";")[0]:""];!f&&i(e)&&(f=t.serialize["application/json"]),f&&(c=f(c))}for(var g in this.header)null!=this.header[g]&&b.setRequestHeader(g,this.header[g]);return this._responseType&&(b.responseType=this._responseType),this.emit("request",this),b.send("undefined"!=typeof c?c:null),this},t.get=function(a,b,c){var d=t("GET",a);return"function"==typeof b&&(c=b,b=null),b&&d.query(b),c&&d.end(c),d},t.head=function(a,b,c){var d=t("HEAD",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},t.options=function(a,b,c){var d=t("OPTIONS",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},t.del=l,t.delete=l,t.patch=function(a,b,c){var d=t("PATCH",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},t.post=function(a,b,c){var d=t("POST",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},t.put=function(a,b,c){var d=t("PUT",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d}},{"./is-function":4,"./is-object":5,"./request-base":6,"./response-base":7,"./should-retry":8,"component-emitter":1}],4:[function(a,b,c){function d(a){var b=e(a)?Object.prototype.toString.call(a):"";return"[object Function]"===b}var e=a("./is-object");b.exports=d},{"./is-object":5}],5:[function(a,b,c){function d(a){return null!==a&&"object"==typeof a}b.exports=d},{}],6:[function(a,b,c){function d(a){if(a)return e(a)}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}var f=a("./is-object");b.exports=d,d.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},d.prototype.parse=function(a){return this._parser=a,this},d.prototype.responseType=function(a){return this._responseType=a,this},d.prototype.serialize=function(a){return this._serializer=a,this},d.prototype.timeout=function(a){return a&&"object"==typeof a?("undefined"!=typeof a.deadline&&(this._timeout=a.deadline),"undefined"!=typeof a.response&&(this._responseTimeout=a.response),this):(this._timeout=a,this._responseTimeout=0,this)},d.prototype.retry=function(a){return 0!==arguments.length&&a!==!0||(a=1),a<=0&&(a=0),this._maxRetries=a,this._retries=0,this},d.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},d.prototype.then=function(a,b){if(!this._fullfilledPromise){var c=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(a,b){c.end(function(c,d){c?b(c):a(d)})})}return this._fullfilledPromise.then(a,b)},d.prototype.catch=function(a){return this.then(void 0,a)},d.prototype.use=function(a){return a(this),this},d.prototype.ok=function(a){if("function"!=typeof a)throw Error("Callback required");return this._okCallback=a,this},d.prototype._isResponseOK=function(a){return!!a&&(this._okCallback?this._okCallback(a):a.status>=200&&a.status<300)},d.prototype.get=function(a){return this._header[a.toLowerCase()]},d.prototype.getHeader=d.prototype.get,d.prototype.set=function(a,b){if(f(a)){for(var c in a)this.set(c,a[c]);return this}return this._header[a.toLowerCase()]=b,this.header[a]=b,this},d.prototype.unset=function(a){return delete this._header[a.toLowerCase()],delete this.header[a],this},d.prototype.field=function(a,b){if(null===a||void 0===a)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),f(a)){for(var c in a)this.field(c,a[c]);return this}if(Array.isArray(b)){for(var d in b)this.field(a,b[d]);return this}if(null===b||void 0===b)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof b&&(b=""+b),this._getFormData().append(a,b),this},d.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},d.prototype.withCredentials=function(a){return void 0==a&&(a=!0),this._withCredentials=a,this},d.prototype.redirects=function(a){return this._maxRedirects=a,this},d.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},d.prototype.send=function(a){var b=f(a),c=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),b&&!this._data)Array.isArray(a)?this._data=[]:this._isHost(a)||(this._data={});else if(a&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(b&&f(this._data))for(var d in a)this._data[d]=a[d];else"string"==typeof a?(c||this.type("form"),c=this._header["content-type"],"application/x-www-form-urlencoded"==c?this._data=this._data?this._data+"&"+a:a:this._data=(this._data||"")+a):this._data=a;return!b||this._isHost(a)?this:(c||this.type("json"),this)},d.prototype.sortQuery=function(a){return this._sort="undefined"==typeof a||a,this},d.prototype._timeoutError=function(a,b){if(!this._aborted){var c=new Error(a+b+"ms exceeded");c.timeout=b,c.code="ECONNABORTED",this.timedout=!0,this.abort(),this.callback(c)}},d.prototype._setTimeouts=function(){var a=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){a._timeoutError("Timeout of ",a._timeout)},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){a._timeoutError("Response timeout of ",a._responseTimeout)},this._responseTimeout))}},{"./is-object":5}],7:[function(a,b,c){function d(a){if(a)return e(a)}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}var f=a("./utils");b.exports=d,d.prototype.get=function(a){return this.header[a.toLowerCase()]},d.prototype._setHeaderProperties=function(a){var b=a["content-type"]||"";this.type=f.type(b);var c=f.params(b);for(var d in c)this[d]=c[d];this.links={};try{a.link&&(this.links=f.parseLinks(a.link))}catch(a){}},d.prototype._setStatusProperties=function(a){var b=a/100|0;this.status=this.statusCode=a,this.statusType=b,this.info=1==b,this.ok=2==b,this.redirect=3==b,this.clientError=4==b,this.serverError=5==b,this.error=(4==b||5==b)&&this.toError(),this.accepted=202==a,this.noContent=204==a,this.badRequest=400==a,this.unauthorized=401==a,this.notAcceptable=406==a,this.forbidden=403==a,this.notFound=404==a}},{"./utils":9}],8:[function(a,b,c){var d=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];b.exports=function(a,b){return!!(a&&a.code&&~d.indexOf(a.code))||(!!(b&&b.status&&b.status>=500)||!!(a&&"timeout"in a&&"ECONNABORTED"==a.code))}},{}],9:[function(a,b,c){c.type=function(a){return a.split(/ *; */).shift()},c.params=function(a){return a.split(/ *; */).reduce(function(a,b){var c=b.split(/ *= */),d=c.shift(),e=c.shift();return d&&e&&(a[d]=e),a},{})},c.parseLinks=function(a){return a.split(/ *, */).reduce(function(a,b){var c=b.split(/ *; */),d=c[0].slice(1,-1),e=c[1].split(/ *= */)[1].slice(1,-1);return a[e]=d,a},{})},c.cleanHeader=function(a,b){return delete a["content-type"],delete a["content-length"],delete a["transfer-encoding"],delete a.host,b&&delete a.cookie,a}},{}],10:[function(a,b,c){(function(c){"use strict";var d="undefined"!=typeof window?window.L:"undefined"!=typeof c?c.L:null,e=a("superagent");a("leaflet.nontiledlayer");d.TileLayer.XServer=d.TileLayer.extend({includes:d.Mixin.Events,_isrsLayer:!1,initialize:function(a,b){if(this._isrsLayer=a.indexOf("/renderMap")!==-1,!this._isrsLayer&&a.indexOf("contentType=JSON")===-1)throw new Error("L.TileLayer.XServer cannot be intatiated directly without contentType=JSON");d.TileLayer.prototype.initialize.call(this,a,b)},onAdd:function(a){this._resetQueue(),d.TileLayer.prototype.onAdd.call(this,a);var b=a._container;b.addEventListener("mousemove",d.bind(this._onMouseMove,this),!0),b.addEventListener("mousedown",d.bind(this._onMouseDown,this),!0),a._mapPane.addEventListener("click",d.bind(this._onClick,this),!0),a.addEventListener("click",d.bind(this._onMapClick,this),!1)},onRemove:function(a){this._resetQueue();var b=a._container;b.removeEventListener("mousemove",d.bind(this._onMouseMove,this),!0),b.removeEventListener("mousedown",d.bind(this._onMouseDown,this),!0),a._mapPane.removeEventListener("click",d.bind(this._onClick,this),!0),a.removeEventListener("click",d.bind(this._onMapClick,this),!1),d.TileLayer.prototype.onRemove.call(this,a)},maxConcurrentRequests:8,requestQueue:[],activeRequests:[],queueId:0,_setView:function(a,b,c,e){var f=Math.round(b);(void 0!==this.options.maxZoom&&f>this.options.maxZoom||void 0!==this.options.minZoom&&f<this.options.minZoom)&&(f=void 0);var g=this.options.updateWhenZooming&&f!==this._tileZoom;g&&this._resetQueue(),d.TileLayer.prototype._setView.call(this,a,b,c,e)},redraw:function(){this._resetQueue(),d.TileLayer.prototype.redraw.call(this)},_resetQueue:function(){this.requestQueue=[],this.queueId=this.queueId+1;for(var a=0;a<this.activeRequests.length;a++)this.activeRequests[a].abort();this.activeRequests=[]},runRequestQ:function(a,b,c,d){if(!d&&this.activeRequests.length>=this.maxConcurrentRequests)return void this.requestQueue.push({url:a,request:b,handleSuccess:c});var f,g=this,h=this.queueId;f=null==b?e.get(a).end(function(a,d){if(g.activeRequests.splice(g.activeRequests.indexOf(b),1),g.queueId==h&&g.requestQueue.length){var e=g.requestQueue.shift();g.runRequestQ(e.url,e.request,e.handleSuccess,!0)}c(a,d)}):e.post(a).set("Content-Type","application/json").send(b).auth(this.options.username,this.options.password).end(function(a,d){if(g.activeRequests.splice(g.activeRequests.indexOf(b),1),g.queueId==h&&g.requestQueue.length){var e=g.requestQueue.shift();g.runRequestQ(e.url,e.request,e.handleSuccess,!0)}c(a,d)}),this.activeRequests.push(f)},findElement:function(a,b){if(!b)return null;var c,e,f,g={},h=Array.prototype.slice.call(b.getElementsByTagName("img"));for(c=0,e=h.length;c<e;c++){f=h[c];for(var i=d.DomEvent.getMousePosition(a,f),j=f._layers.length-1;j>=0;j--){var k=f._layers[j],l=Math.abs(k.pixelBoundingBox.right-k.pixelBoundingBox.left),m=Math.abs(k.pixelBoundingBox.top-k.pixelBoundingBox.bottom);k.referencePixelPoint.x-l/2<=i.x&&k.referencePixelPoint.x+l/2>=i.x&&k.referencePixelPoint.y-m/2<=i.y&&k.referencePixelPoint.y+m/2>=i.y&&(g[k.id]||(g[k.id]=k))}}return Object.keys(g).length>0?g:null},_onMouseMove:function(a){!this._map||this._map.dragging._draggable._moving||this._map._animatingZoom||(this.findElement(a,this._container)?(a.preventDefault(),this._map._container.style.cursor="pointer",a.stopPropagation()):this._map._container.style.cursor="")},_onMouseDown:function(a){var b=this.findElement(a,this._container);if(b)return a.preventDefault(),a.stopPropagation(),!1},_onClick:function(a){var b=this.findElement(a,this._container);if(b){a.preventDefault();var c=this.buildDescriptionText(b),e=b[Object.keys(b)[0]].latLng;return d.popup().setLatLng(e).setContent(c).openOn(this._map),a.stopPropagation(),!1}},_onMapClick:function(a){var b=this.findElement(a.originalEvent,this._container);if(b){var c=this.buildDescriptionText(b),e=b[Object.keys(b)[0]].latLng;return d.popup().setLatLng(e).setContent(c).openOn(this._map),!1}},buildDescriptionText:function(a){var b="",c=!0;for(var d in a){c?c=!1:b+="<br>";for(var e=0;e<a[d].attributes.length;e++){var f=a[d].attributes[e];b=b.concat(f.key.replace(/[A-Z]/g," $&")+": "+f.value.replace("_"," ")+"<br>")}}return b.toLowerCase()},pixToLatLng:function(a,b){var c=Math.PI,e=2*c,f=e/Math.pow(2,a.z),g=-c+(a.x+b.x/256)*f,h=c-(a.y+b.y/256)*f;return d.latLng(360/Math.PI*(Math.atan(Math.exp(h))-Math.PI/4),180/Math.PI*g)},createTile:function(a,b){var c=document.createElement("img");d.DomEvent.on(c,"load",d.bind(this._tileOnLoad,this,b,c)),d.DomEvent.on(c,"error",d.bind(this._tileOnError,this,b,c)),this.options.crossOrigin&&(c.crossOrigin=""),c.alt="",c.setAttribute("role","presentation");var e=this.getTileUrl(a);if(this._isrsLayer){var f={mapSection:{$type:"MapSectionByTileKey",zoomLevel:a.z,x:a.x,y:a.y},imageOptions:{width:256,height:256},resultFields:{
image:!0}};this.options.requestExtension&&(f=d.extend(f,this.options.requestExtension))}return c._map=this._map,c._layers=[],this.runRequestQ(e,f,d.bind(function(b,d){if(this._map){if(b)return void(c.src="");var e=JSON.parse(d.text),f={iVBOR:"data:image/png;base64,",R0lGO:"data:image/gif;base64,","/9j/4":"data:image/jpeg;base64,",Qk02U:"data:image/bmp;base64,"},g=e.image;if(c.src=f[g.substr(0,5)]+g,e.features)for(var h=e.features,i=0;i<h.length;i++){var j=h[i];j.latLng=this.pixToLatLng(a,j.referencePixelPoint),c._layers.push(j)}}},this)),c}}),d.tileLayer.xserver=function(a,b){return a.indexOf("/renderMap")!==-1||a.indexOf("contentType=JSON")!==-1?new d.TileLayer.XServer(a,b):new d.TileLayer(a,b)},b.exports=d.tileLayer.xserver}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"leaflet.nontiledlayer":2,superagent:3}],11:[function(a,b,c){(function(c){"use strict";var d="undefined"!=typeof window?window.L:"undefined"!=typeof c?c.L:null,e=a("superagent");d.TileLayer.XServer07=d.TileLayer.extend({includes:d.Mixin.Events,initialize:function(a,b){if(a.indexOf("contentType=JSON")===-1)throw new Error("L.TileLayer.XServer cannot be intatiated directly without contentType=JSON");d.TileLayer.prototype.initialize.call(this,a,b)},onAdd:function(a){this._resetQueue(),d.TileLayer.prototype.onAdd.call(this,a);var b=a._container;d.DomEvent.on(b,"mousemove",this._onMouseMove,this).on(b,"mousedown",this._onMouseDown,this).on(b,"click",this._onClick,this)},onRemove:function(a){this._resetQueue(),d.TileLayer.prototype.onRemove.call(this,a)},_initContainer:function(){var a=this.options.pane?this.options.pane:this._map._panes.tilePane;if(!this._container){if(this._container=d.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var b="leaflet-tile-container";this._bgBuffer=d.DomUtil.create("div",b,this._container),this._tileContainer=d.DomUtil.create("div",b,this._container)}else this._tileContainer=this._container;this._tileContainer.style.zIndex=this.options.zIndex,a.appendChild(this._container),this._map._container.style["pointer-events"]="auto",this.options.opacity<1&&this._updateOpacity()}},findElement:function(a,b){if(!b)return null;var c,e,f,g=Array.prototype.slice.call(b.getElementsByTagName("img"));for(c=0,e=g.length;c<e;c++){f=g[c];for(var h=d.DomEvent.getMousePosition(a,f),i=f._layers.length-1;i>=0;i--){var j=f._layers[i],k=Math.abs(j.pixelBoundingBox.right-j.pixelBoundingBox.left),l=Math.abs(j.pixelBoundingBox.top-j.pixelBoundingBox.bottom);if(j.referencePixelPoint.x-k/2<=h.x&&j.referencePixelPoint.x+k/2>=h.x&&j.referencePixelPoint.y-l/2<=h.y&&j.referencePixelPoint.y+l/2>=h.y)return j}}return null},_onMouseMove:function(a){!this._map||this._map.dragging._draggable._moving||this._map._animatingZoom||(this.findElement(a,this._container)?(a.preventDefault(),this._container.style["pointer-events"]="auto",d.DomUtil.addClass(this._container,"leaflet-clickable")):(this._container.style["pointer-events"]="none",d.DomUtil.removeClass(this._container,"leaflet-clickable")))},_onMouseDown:function(a){var b=this.findElement(a,this._container);if(b)return a.preventDefault(),a.stopPropagation(),!1},_onClick:function(a){var b=this.findElement(a,this._container);if(b){a.preventDefault();for(var c="",e=0;e<b.attributes.length;e++){var f=b.attributes[e];c=c.concat(f.key.replace(/[A-Z]/g," $&")+": "+f.value.replace("_"," ")+"<br>")}return d.popup().setLatLng(b.latLng).setContent(c.toLowerCase()).openOn(map),a.stopPropagation(),!1}},pixToLatLng:function(a,b){var c=Math.PI,e=2*c,f=e/Math.pow(2,a.z),g=-c+(a.x+b.x/256)*f,h=c-(a.y+b.y/256)*f;return d.latLng(360/Math.PI*(Math.atan(Math.exp(h))-Math.PI/4),180/Math.PI*g)},maxConcurrentRequests:8,requestQueue:[],activeRequests:[],queueId:0,_reset:function(){this._resetQueue(),d.TileLayer.prototype._reset.call(this)},_resetQueue:function(){this.requestQueue=[],this.queueId=this.queueId+1;for(var a=0;a<this.activeRequests.length;a++)this.activeRequests[a].abort();this.activeRequests=[]},runRequestQ:function(a,b,c){if(!c&&this.activeRequests.length>=this.maxConcurrentRequests)return void this.requestQueue.push({url:a,handleSuccess:b});var d=this,f=this.queueId,g=e.get(a).end(function(a,c){if(d.activeRequests.splice(d.activeRequests.indexOf(g),1),d.queueId==f&&d.requestQueue.length){var e=d.requestQueue.shift();d.runRequestQ(e.url,e.handleSuccess,!0)}b(a,c)});this.activeRequests.push(g)},_loadTile:function(a,b){if(this._map){a._map=this._map,a._layers=[],a._layer=this,a.onload=this._tileOnLoad,a.onerror=this._tileOnError,this._adjustTilePoint(b);var c=this.getTileUrl(b);this.runRequestQ(c,d.bind(function(c,d){if(this._map){if(c)return void(a.src="");var e=JSON.parse(d.text),f={iVBOR:"data:image/png;base64,",R0lGO:"data:image/gif;base64,","/9j/4":"data:image/jpeg;base64,",Qk02U:"data:image/bmp;base64,"},g=e.image;if(a.src=f[g.substr(0,5)]+g,e.features)for(var h=e.features,i=0;i<h.length;i++){var j=h[i];j.latLng=this.pixToLatLng(b,j.referencePixelPoint),a._layers.push(j)}}},this)),this.fire("tileloadstart",{tile:a,url:a.src})}}}),d.tileLayer.xserver07=function(a,b){return a.indexOf("contentType=JSON")!==-1?new d.TileLayer.XServer07(a,b):new d.TileLayer(a,b)},b.exports=d.tileLayer.xserver07}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{superagent:3}]},{},[10,11])(11)});
//# sourceMappingURL=leaflet-xserver.js.map